<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scene Generator</title>
    <link rel="stylesheet" href="/static/styles/style.css">
    <style>
        .button-style {
            font-size: 18px;
            padding: 10px 20px;
            border: 1px solid #666;
            border-radius: 8px;
            background-color: #333;
            color: white;
            font-family: 'CM Handwriting One', sans-serif;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .button-style:hover {
            background-color: #444;
        }

        .character-name-input {
            font-size: 70px;
            color: #3498db;
        }

        .dialogue-box {
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 230px);
            height: 230px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-image: url('/static/images/aaa.png');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            z-index: 75;
            opacity: 0.95;
            box-sizing: border-box;
            padding: 20px;
        }
    </style>
</head>
<body>

    <!-- Full-Screen Preview Area -->
    <div class="preview" id="preview-background" style="background-image: url('/static/backgrounds/{{ selected_background }}');">
        <!-- Menu Controls -->
        <div class="menu" id="menu">
            <label for="background">Background:</label>
            <select id="background" onchange="updateBackground(this.value)">
                <option value="classroom.jpg">Classroom</option>
                <option value="cafeteria.jpg">Cafeteria</option>
                <option value="bathroom.jpg">Bathroom</option>
                <option value="phonk.jpeg">Phonk</option>
            </select>
            
            <label for="character">Character:</label>
            <select id="character-select">
                <option value="jecka_1.png">Jecka</option>
                <option value="nicole_1.png">Nicole</option>
                <option value="jeffery_1.png">Jeffery</option>
                <option value="elias.png">Elias</option>
            </select>

            <button class="button-style" onclick="addCharacter()">Add Character</button>
            <button class="button-style" onclick="togglePlacementEditor()">Placement</button>
            <button class="button-style" onclick="toggleDialogueCreator()">Add Dialogue</button>
            <button class="button-style" onclick="startScenePreview()">Preview Scene</button>
        </div>

        <!-- Placement Editor Section -->
        <div id="placement-editor">
            <h3>Character Placement</h3>
            <div id="placement-controls"></div>
            <button class="button-style" onclick="togglePlacementEditor()">Close</button>
        </div>

        <!-- Dialogue Creator Section -->
        <div id="dialogue-creator" style="display: none;">
            <h3>Add Dialogue</h3>
            <div id="dialogue-list"></div>
            <input type="text" id="dialogue-input" placeholder="Enter dialogue..." style="width: 80%;">
            <button class="button-style" onclick="addDialogue()">Add Dialogue</button>
        </div>

        <div class="dialogue-box" id="dialogue-box">
            <input type="text" class="character-name-input" id="preview-character-name" readonly placeholder="tfjoek">
            <textarea class="dialogue-input" id="preview-dialogue-text" readonly placeholder="click the buttons and stuff happens also star my project on github PLEASE (updates wil b posted on there)"></textarea>
        </div>
    </div>

    <script>
        let dialogues = [];
        let currentDialogueIndex = 0;
        let characters = [];
        let previewMode = false;
        
        const backgroundNames = {
            "classroom.jpg": "Classroom",
            "cafeteria.jpg": "Cafeteria",
            "bathroom.jpg": "Bathroom",
            "phonk.jpeg": "Phonk"
        };

        const characterNames = {
            "elias.png": "Elias",
            "jecka_1.png": "Jecka",
            "nicole_1.png": "Nicole",
            "jeffery_1.png": "Jeffery"
        };

        function updateBackground(background) {
            document.querySelector(".preview").style.backgroundImage = `url('/static/backgrounds/${background}')`;
        }

        function addCharacter() {
            const characterFile = document.getElementById("character-select").value;
            const characterName = characterNames[characterFile] || "Unknown Character";

            if (!characters.some(char => char.file === characterFile)) {
                const img = document.createElement("img");
                img.src = `/static/characters/${characterFile}`;
                img.classList.add("character-display");
                img.style.position = "absolute";
                img.style.bottom = "0%";
                img.style.left = `${10 + characters.length * 20}%`;
                img.style.transform = "translateX(-50%)";
                document.querySelector(".preview").appendChild(img);

                characters.push({ file: characterFile, name: characterName, element: img });
                updatePlacementControls();
            }
        }

        function togglePlacementEditor() {
            const editor = document.getElementById("placement-editor");
            editor.style.display = editor.style.display === "none" ? "block" : "none";
            if (editor.style.display === "block") {
                updatePlacementControls();
            }
        }

        function updatePlacementControls() {
            const container = document.getElementById("placement-controls");
            container.innerHTML = "";
            characters.forEach((character, index) => {
                const sliderContainer = document.createElement("div");
                sliderContainer.classList.add("slider-container");
                sliderContainer.innerHTML = `
                    <label>Position for ${character.name}</label>
                    <input type="range" min="0" max="100" value="${parseInt(character.element.style.left)}" oninput="moveCharacter(${index}, this.value)">
                `;
                container.appendChild(sliderContainer);
            });
        }

        function moveCharacter(index, value) {
            characters[index].element.style.left = `${value}%`;
        }

        function toggleDialogueCreator() {
            const creator = document.getElementById("dialogue-creator");
            creator.style.display = creator.style.display === "none" ? "block" : "none";
        }

        function addDialogue() {
            const text = document.getElementById("dialogue-input").value;
            const characterFile = document.getElementById("character-select").value;
            const characterName = characterNames[characterFile] || "Unknown Character";

            if (text) {
                dialogues.push({ character: characterName, characterFile, text });
                updateDialogueList();
                document.getElementById("dialogue-input").value = '';
            }
        }

        function updateCharacterForDialogue(index, characterFile) {
            const characterName = characterNames[characterFile] || "Unknown Character";
            dialogues[index].character = characterName;
            dialogues[index].characterFile = characterFile;
        }

        function updateDialogueList() {
            const list = document.getElementById("dialogue-list");
            list.innerHTML = "";

            dialogues.forEach((dialogue, index) => {
                const item = document.createElement("div");
                item.className = "dialogue-item";
                item.innerHTML = `
                    <b>Dialogue:</b> ${dialogue.text}
                    <select onchange="updateCharacterForDialogue(${index}, this.value)">
                        ${characters.map(({ file, name }) => `
                            <option value="${file}" ${dialogue.characterFile === file ? 'selected' : ''}>${name}</option>
                        `).join('')}
                    </select>
                    <button class="button-style" onclick="deleteDialogue(${index})">Delete</button>
                `;
                list.appendChild(item);
            });
        }

        function deleteDialogue(index) {
            dialogues.splice(index, 1);
            updateDialogueList();
        }

        function startScenePreview() {
            if (dialogues.length > 0) {
                currentDialogueIndex = 0;
                displayCurrentDialogue();
                document.getElementById("dialogue-box").style.display = "block";
                document.getElementById("dialogue-creator").style.display = "none";
                document.getElementById("menu").style.display = "none";
                previewMode = true;
            } else {
                resetDialogueBox();
            }
        }

        function displayCurrentDialogue() {
            const dialogue = dialogues[currentDialogueIndex];
            document.getElementById("preview-character-name").value = dialogue.character;
            document.getElementById("preview-dialogue-text").value = dialogue.text;
        }

        function nextDialogue() {
            if (previewMode) {
                if (currentDialogueIndex < dialogues.length - 1) {
                    currentDialogueIndex++;
                    displayCurrentDialogue();
                } else {
                    alert("End of scene.");
                    resetDialogueBox();
                    currentDialogueIndex = 0;
                    previewMode = false;
                    document.getElementById("menu").style.display = "flex";
                }
            }
        }

        document.getElementById("preview-background").addEventListener("click", nextDialogue);

        document.querySelectorAll(".button-style, #placement-editor, #dialogue-creator").forEach(el => {
            el.addEventListener("click", event => event.stopPropagation());
        });

        function resetDialogueBox() {
            document.getElementById("preview-character-name").value = '';
            document.getElementById("preview-dialogue-text").value = '';
        }
    </script>
</body>
</html>
